<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Hidden iframe for stealth PiP activation */
    #phantomFrame {
      width: 0;
      height: 0;
      border: none;
      visibility: hidden;
    }
  </style>
</head>
<body>
  <h1>Main PWA</h1>
  <div id="activateArea">Tap to Initialize</div>
  <!-- Phantom iframe for cross-domain gesture chaining -->
  <iframe id="phantomFrame" src="https://YOUR_GITHUB_USERNAME.github.io/pip-video-external/"></iframe>

  <script>
    const activateArea = document.getElementById('activateArea');
    const phantomFrame = document.getElementById('phantomFrame');

    // Step 1: Capture user gesture in main PWA
    activateArea.addEventListener('touchend', async () => {
      console.log('Phase 1: User gesture captured in PWA');
      
      // Step 2: Inject code into iframe before navigation
      phantomFrame.contentWindow.postMessage({
        action: 'preloadVideo',
        videoSrc: 'https://devstreaming-cdn.apple.com/videos/streaming/examples/bipbop_4x3/bipbop_4x3_variant.m3u8'
      }, '*');

      // Step 3: Open external page in hidden Safari context
      window.open('https://YOUR_GITHUB_USERNAME.github.io/pip-video-external/', '_blank', 'noopener=yes');
    });

    // Step 4: Listen for PiP success from external page
    window.addEventListener('message', (e) => {
      if (e.data === 'pipSuccess') {
        console.log('Phase 4: PiP activated successfully!');
      }
    });
  </script>
</body>
</html>
